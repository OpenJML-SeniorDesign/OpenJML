#! /bin/bash

SPECS=/Users/davidcok/projects/OpenJMLB/Specs/specs
arg=$1
d=$(basename $arg)
cd $arg/../..
p=test/$d

if [ -e skip ]; then
    echo Skipping $d
elif [ -e rac ]; then
    echo Skipped-rac $d
else
    echo Testing $d
    openjml -jmltesting -no-staticInitWarning -timeout=600 -specspath $p:$SPECS -esc -progress -dir $p > $p/actual 2>&1
    if [ -e $p/expected ]; then
        ( diff -q $p/expected $p/actual && rm $p/actual ) || exit 1
    else
        echo "No expected output for test " $d
        exit 1
    fi
fi
exit 0
